---
import HeadMeta from './HeadMeta.astro';
import Header from './Header.astro';
import Footer from './Footer.astro';
import NormalJsonLd from '@/components/json-ld/normal.astro';
import slateConfig from '~@/slate.config';
import { getFullTitle } from '@/helpers/utils';
import '@/assets/style/common.css';

interface Props {
  title?: string;
  description?: string;
  image?: string;
}

const {
  title = '',
  description = slateConfig.description,
  image = '/og_image.png',
} = Astro.props;
const fullTitle = getFullTitle(title);

// remark: Temporary solution to refresh theme flicker issue
const themeScript = `
  function getThemeMode() {
    const theme = localStorage.getItem('theme');
    if (theme && (theme === 'light' || theme === 'dark')) return theme;

    const presetTheme = theme === 'auto' ? theme : '${slateConfig.theme?.mode}';
    if (presetTheme === 'auto')
      return window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light';

    return presetTheme;
  }
  const mode = getThemeMode();
  document.documentElement.className = mode;
  document.documentElement.dataset.theme = mode;
`;
---

<!doctype html>
<html lang={slateConfig.lang}>
  <head>
    <HeadMeta title={fullTitle} description={description} image={image} />
    <slot name="json-ld">
      <NormalJsonLd title={fullTitle} description={description} image={image} />
    </slot>
    <script is:inline set:html={themeScript}></script>
    <script
      src="https://rybbit.samsoncj.xyz/api/script.js"
      data-site-id="0f5b39079335"
      async
      defer
    ></script>
    <script type="text/javascript" is:inline>
        (function(c,l,a,r,i,t,y){
            // eslint-disable-next-line prefer-rest-params
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "u9igu6nyli");
    </script>
  </head>
  <body class="bg-slate1">
    <div class="m-auto flex min-h-dvh max-w-180 flex-col px-6 pb-6 pt-18">
      <slot name="header">
        <Header />
      </slot>
      <slot />
      <slot name="footer">
        <Footer />
      </slot>
    </div>
  </body>
</html>
